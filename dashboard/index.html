<!doctype html>
<html lang="fr">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Bot Ops Dashboard</title>
  <meta name="description" content="Tableau de bord professionnel pour piloter votre bot Discord." />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&display=swap"
    rel="stylesheet" />
  <style>
    *,
    *::before,
    *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0
    }

    :root {
      --bg: #03070c;
      --bg1: #060d1b;
      --surf: rgba(11, 21, 37, .4);
      --surfs: rgba(9, 17, 31, .85);
      --line: rgba(255, 255, 255, .08);
      --lines: rgba(255, 255, 255, .15);
      --text: #f0f4f8;
      --muted: #8fa3bc;
      --brand: #6366f1;
      --brand2: #8b5cf6;
      --teal: #10b981;
      --cyan: #06b6d4;
      --ok: #22c55e;
      --err: #ef4444;
      --warn: #f59e0b;
      --sb: 250px;
      --r: 20px;
      --rs: 12px;
      --tr: .3s cubic-bezier(.4, 0, .2, 1);
      --glow: 0 0 20px rgba(99, 102, 241, .2);
    }

    html {
      height: 100%;
      scroll-behavior: smooth
    }

    body {
      font-family: "Outfit", sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      overflow-x: hidden
    }

    /* grid bg */
    /* Mesh Gradient Background */
    body::before {
      content: "";
      position: fixed;
      inset: 0;
      z-index: -2;
      background: var(--bg);
      background-image:
        radial-gradient(at 0% 0%, hsla(253, 16%, 7%, 1) 0, transparent 50%),
        radial-gradient(at 50% 0%, hsla(225, 39%, 30%, 1) 0, transparent 50%),
        radial-gradient(at 100% 0%, hsla(339, 49%, 30%, 1) 0, transparent 50%),
        radial-gradient(at 0% 50%, hsla(225, 39%, 30%, 1) 0, transparent 50%),
        radial-gradient(at 100% 50%, hsla(253, 16%, 7%, 1) 0, transparent 50%),
        radial-gradient(at 0% 100%, hsla(339, 49%, 30%, 1) 0, transparent 50%),
        radial-gradient(at 50% 100%, hsla(225, 39%, 30%, 1) 0, transparent 50%),
        radial-gradient(at 100% 100%, hsla(253, 16%, 7%, 1) 0, transparent 50%);
      filter: blur(100px);
      animation: meshAnim 15s ease infinite alternate;
    }

    @keyframes meshAnim {
      0% {
        transform: scale(1) rotate(0deg);
      }

      100% {
        transform: scale(1.1) rotate(2deg);
      }
    }

    body::after {
      content: "";
      position: fixed;
      inset: 0;
      z-index: -1;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
      opacity: 0.05;
      pointer-events: none;
    }

    /* scrollbar */
    ::-webkit-scrollbar {
      width: 5px;
      height: 5px
    }

    ::-webkit-scrollbar-track {
      background: transparent
    }

    ::-webkit-scrollbar-thumb {
      background: var(--lines);
      border-radius: 4px
    }

    /* ── Sidebar ── */
    #sidebar {
      position: fixed;
      top: 0;
      left: 0;
      bottom: 0;
      width: var(--sb);
      background: var(--surfs);
      border-right: 1px solid var(--line);
      backdrop-filter: blur(40px) saturate(180%);
      display: flex;
      flex-direction: column;
      z-index: 100;
      transition: transform var(--tr);
      box-shadow: 10px 0 30px rgba(0, 0, 0, 0.5);
    }

    .sb-head {
      padding: 20px 16px 16px;
      border-bottom: 1px solid var(--line);
      display: flex;
      align-items: center;
      gap: 12px
    }

    .sb-icon {
      width: 38px;
      height: 38px;
      border-radius: 11px;
      background: linear-gradient(135deg, var(--brand), var(--teal));
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 19px;
      box-shadow: 0 0 24px rgba(88, 101, 242, .45);
      flex-shrink: 0
    }

    .sb-name {
      font-size: 14px;
      font-weight: 800;
      line-height: 1.2
    }

    .sb-sub {
      font-size: 11px;
      color: var(--muted)
    }

    .sb-online {
      margin: 12px 14px;
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 7px 11px;
      background: rgba(62, 207, 142, .1);
      border: 1px solid rgba(62, 207, 142, .25);
      border-radius: 8px;
      font-size: 12px;
      color: var(--ok);
      font-weight: 600
    }

    .dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: var(--ok);
      animation: pulse 2s ease-in-out infinite;
      flex-shrink: 0
    }

    @keyframes pulse {

      0%,
      100% {
        box-shadow: 0 0 0 0 rgba(62, 207, 142, .55)
      }

      50% {
        box-shadow: 0 0 0 6px rgba(62, 207, 142, 0)
      }
    }

    /* ── Notifications ── */
    #toast-wrap {
      position: fixed;
      bottom: 30px;
      right: 30px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      z-index: 1000;
      pointer-events: none
    }

    .toast {
      min-width: 280px;
      padding: 14px 20px;
      background: var(--surfs);
      border: 1px solid var(--line);
      border-radius: var(--rs);
      color: #fff;
      font-size: 14px;
      font-weight: 500;
      backdrop-filter: blur(20px);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
      display: flex;
      align-items: center;
      gap: 12px;
      animation: toast-in 0.4s cubic-bezier(0.16, 1, 0.3, 1), toast-out 0.4s 2.6s forwards;
      pointer-events: auto;
      border-left: 4px solid var(--line)
    }

    .toast-ok {
      border-left-color: var(--ok);
      background: rgba(62, 207, 142, 0.1)
    }

    .toast-err {
      border-left-color: var(--err);
      background: rgba(240, 78, 106, 0.1)
    }

    .toast i {
      font-size: 16px
    }

    @keyframes toast-in {
      from {
        transform: translateX(100px);
        opacity: 0
      }

      to {
        transform: translateX(0);
        opacity: 1
      }
    }

    @keyframes toast-out {
      to {
        transform: translateY(20px);
        opacity: 0
      }
    }

    /* ── Utilities ── */
    .spinner {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 0.8s linear infinite;
      margin-right: 8px
    }

    .btn-loading {
      pointer-events: none;
      opacity: 0.8
    }

    @keyframes spin {
      to {
        transform: rotate(360deg)
      }
    }

    .cmd-cat-title {
      font-size: 12px;
      font-weight: 800;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin: 24px 0 12px 6px;
      display: flex;
      align-items: center;
      gap: 8px
    }

    .cmd-cat-title::after {
      content: "";
      flex: 1;
      height: 1px;
      background: var(--line)
    }

    .sb-nav {
      flex: 1;
      padding: 4px 10px;
      display: flex;
      flex-direction: column;
      gap: 2px;
      overflow-y: auto
    }

    .nav-sec {
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: .9px;
      color: var(--muted);
      padding: 12px 8px 6px
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      border-radius: var(--rs);
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      color: var(--muted);
      transition: all var(--tr);
      border: 1px solid transparent;
      user-select: none;
      position: relative;
      overflow: hidden;
    }

    .nav-item:hover {
      background: rgba(255, 255, 255, .05);
      color: var(--text);
      transform: translateX(4px);
    }

    .nav-item.active {
      background: linear-gradient(90deg, rgba(99, 102, 241, .15) 0%, transparent 100%);
      color: var(--text);
      border-left: 3px solid var(--brand);
      font-weight: 600;
    }

    .nav-item .ico {
      font-size: 15px;
      width: 20px;
      text-align: center;
      flex-shrink: 0
    }

    .sb-foot {
      padding: 14px;
      border-top: 1px solid var(--line);
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 8px
    }

    .sf-stat {
      display: flex;
      flex-direction: column;
      gap: 2px
    }

    .sf-label {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: .6px;
      color: var(--muted)
    }

    .sf-val {
      font-weight: 800;
      font-size: 13px;
      color: var(--text)
    }

    /* ── Main ── */
    #main {
      margin-left: var(--sb);
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      position: relative;
      z-index: 1
    }

    #topbar {
      position: sticky;
      top: 0;
      z-index: 50;
      background: rgba(6, 12, 23, .85);
      backdrop-filter: blur(14px);
      border-bottom: 1px solid var(--line);
      padding: 11px 26px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px
    }

    .tb-title {
      font-size: 16px;
      font-weight: 700
    }

    .tb-pills {
      display: flex;
      gap: 7px;
      align-items: center;
      flex-wrap: wrap
    }

    .pill {
      display: flex;
      align-items: center;
      gap: 5px;
      padding: 4px 10px;
      border-radius: 20px;
      background: var(--surf);
      border: 1px solid var(--line);
      font-size: 12px;
      font-weight: 600;
      white-space: nowrap;
      transition: border-color var(--tr)
    }

    .pill:hover {
      border-color: var(--lines)
    }

    .pill-lbl {
      color: var(--muted);
      font-weight: 400
    }

    /* ── Pages ── */
    .page {
      display: none;
      padding: 32px;
      flex-direction: column;
      gap: 24px;
    }

    .page.active {
      display: flex;
    }

    .page.active>* {
      animation: slideUp var(--tr) both;
    }

    /* Staggered animation for children */
    .page.active>*:nth-child(1) {
      animation-delay: 0.1s;
    }

    .page.active>*:nth-child(2) {
      animation-delay: 0.2s;
    }

    .page.active>*:nth-child(3) {
      animation-delay: 0.3s;
    }

    .page.active>*:nth-child(4) {
      animation-delay: 0.4s;
    }

    .page.active>*:nth-child(5) {
      animation-delay: 0.5s;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .ph h1 {
      font-size: 21px;
      font-weight: 900;
      letter-spacing: -.3px
    }

    .ph p {
      color: var(--muted);
      font-size: 13px;
      margin-top: 3px
    }

    /* ── Cards ── */
    .card {
      background: var(--surf);
      border: 1px solid var(--line);
      border-radius: var(--r);
      padding: 24px;
      backdrop-filter: blur(16px);
      transition: border-color var(--tr), transform var(--tr), box-shadow var(--tr);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--line), transparent);
    }

    .card:hover {
      border-color: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
    }

    .card-title {
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: .8px;
      color: var(--muted);
      margin-bottom: 14px;
      display: flex;
      align-items: center;
      gap: 7px
    }

    .card-title .ct-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--brand);
      box-shadow: 0 0 8px var(--brand)
    }

    /* ── Ring gauges ── */
    .gauges {
      display: flex;
      gap: 14px;
      flex-wrap: wrap;
      justify-content: space-around;
      padding: 8px 0
    }

    .gauge-wrap {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px
    }

    .gauge-lbl {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: .7px;
      color: var(--muted)
    }

    .gauge-val {
      font-size: 18px;
      font-weight: 900;
      text-align: center;
      background: linear-gradient(135deg, #fff, var(--muted));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    svg.ring {
      transform: rotate(-90deg)
    }

    .ring-bg {
      fill: none;
      stroke: rgba(255, 255, 255, .06);
      stroke-width: 7
    }

    .ring-fg {
      fill: none;
      stroke-width: 7;
      stroke-linecap: round;
      transition: stroke-dashoffset .6s cubic-bezier(.4, 0, .2, 1)
    }

    .ring-cpu .ring-fg {
      stroke: url(#gCpu)
    }

    .ring-heap .ring-fg {
      stroke: url(#gHeap)
    }

    /* ── Flat metric tiles ── */
    .mtiles {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 10px
    }

    .mtile {
      background: rgba(255, 255, 255, .03);
      border: 1px solid var(--line);
      border-radius: var(--rs);
      padding: 16px 18px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      transition: all var(--tr);
      cursor: default;
      backdrop-filter: blur(8px);
    }

    .mtile:hover {
      border-color: var(--brand);
      background: rgba(88, 101, 242, .05);
      transform: translateY(-4px);
      box-shadow: var(--glow);
    }

    .mt-label {
      font-size: 10.5px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: .7px;
      color: var(--muted)
    }

    .mt-val {
      font-size: 22px;
      font-weight: 900;
      letter-spacing: -.5px;
      background: linear-gradient(135deg, var(--text), var(--muted));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text
    }

    .mt-val.accent {
      background: linear-gradient(135deg, var(--brand2), var(--teal));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text
    }

    /* ── Sparkline ── */
    .spark-wrap {
      display: flex;
      flex-direction: column;
      gap: 6px
    }

    .spark-label {
      display: flex;
      justify-content: space-between;
      font-size: 11px;
      color: var(--muted)
    }

    canvas#sparkline {
      width: 100%;
      height: 56px;
      border-radius: 6px;
      display: block
    }

    /* ── Forms ── */
    .field {
      display: flex;
      flex-direction: column;
      gap: 5px
    }

    label {
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: .7px;
      color: var(--muted)
    }

    input,
    select {
      background: rgba(255, 255, 255, .05);
      color: var(--text);
      border: 1px solid var(--line);
      border-radius: var(--rs);
      padding: 11px 16px;
      font-size: 14px;
      font-family: inherit;
      width: 100%;
      outline: none;
      transition: all var(--tr);
      -webkit-appearance: none;
      appearance: none;
    }

    input:focus,
    select:focus {
      border-color: rgba(88, 101, 242, .7);
      box-shadow: 0 0 0 3px rgba(88, 101, 242, .15)
    }

    select option {
      background: #0a1422
    }

    /* ── Buttons ── */
    button {
      font-family: inherit;
      cursor: pointer;
      border-radius: var(--rs);
      font-size: 13.5px;
      font-weight: 600;
      padding: 9px 15px;
      border: 1px solid transparent;
      transition: opacity var(--tr), transform var(--tr), box-shadow var(--tr);
      white-space: nowrap
    }

    button:active {
      transform: scale(.97)
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--brand), var(--brand2));
      color: #fff;
      box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
      border: 1px solid rgba(255, 255, 255, 0.1);
      position: relative;
      overflow: hidden;
    }

    .btn-primary::after {
      content: "";
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
      transform: rotate(45deg);
      transition: .5s;
    }

    .btn-primary:hover::after {
      left: 100%;
    }

    .btn-primary:hover {
      box-shadow: 0 8px 25px rgba(99, 102, 241, 0.6);
      transform: translateY(-2px);
      filter: brightness(1.1);
    }

    .btn-ghost {
      background: rgba(255, 255, 255, .06);
      color: var(--text);
      border-color: var(--line)
    }

    .btn-ghost:hover {
      background: rgba(255, 255, 255, .1)
    }

    .btn-danger {
      background: rgba(240, 78, 106, .12);
      color: var(--err);
      border-color: rgba(240, 78, 106, .28)
    }

    .btn-danger:hover {
      background: rgba(240, 78, 106, .2)
    }

    .btn-row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center
    }

    /* ── Status bar ── */
    .sbar {
      min-height: 19px;
      font-size: 12.5px;
      font-weight: 500;
      margin-top: 6px
    }

    .sbar.ok {
      color: var(--ok)
    }

    .sbar.err {
      color: var(--err)
    }

    /* ── Command search ── */
    .cmd-search {
      position: relative;
      margin-bottom: 10px
    }

    .cmd-search input {
      padding-left: 34px
    }

    .cmd-search::before {
      content: "⌕";
      position: absolute;
      left: 11px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 15px;
      color: var(--muted);
      pointer-events: none
    }

    /* ── Command list ── */
    .cmd-grid {
      display: flex;
      flex-direction: column;
      gap: 6px
    }

    .cmd-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: rgba(9, 17, 31, .65);
      border: 1px solid var(--line);
      border-radius: var(--rs);
      padding: 10px 14px;
      gap: 12px;
      transition: border-color var(--tr), background var(--tr)
    }

    .cmd-row:hover {
      border-color: var(--lines);
      background: rgba(9, 17, 31, .9)
    }

    .cmd-name {
      font-family: "Courier New", monospace;
      font-size: 13px;
      color: var(--cyan);
      font-weight: 700
    }

    .toggle-wrap {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-shrink: 0
    }

    .tlbl {
      font-size: 12px;
      color: var(--muted);
      min-width: 64px;
      text-align: right;
      font-weight: 500
    }

    .toggle {
      position: relative;
      width: 38px;
      height: 21px;
      flex-shrink: 0
    }

    .toggle input {
      width: 0;
      height: 0;
      opacity: 0;
      position: absolute
    }

    .track {
      position: absolute;
      inset: 0;
      background: rgba(255, 255, 255, .05);
      border: 1px solid var(--line);
      border-radius: 20px;
      cursor: pointer;
      transition: all var(--tr);
    }

    .track::after {
      content: "";
      position: absolute;
      top: 3px;
      left: 3px;
      width: 13px;
      height: 13px;
      border-radius: 50%;
      background: var(--muted);
      transition: all var(--tr);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
    }

    .toggle input:checked~.track {
      background: var(--brand);
      border-color: var(--brand2);
      box-shadow: var(--glow);
    }

    .toggle input:checked~.track::after {
      transform: translateX(17px);
      background: #fff;
    }

    /* ── Events ── */
    .efeed {
      display: flex;
      flex-direction: column;
      gap: 6px;
      max-height: 500px;
      overflow-y: auto;
      padding-right: 4px
    }

    .eitem {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      background: rgba(9, 17, 31, .65);
      border: 1px solid var(--line);
      border-radius: var(--rs);
      padding: 10px 13px;
      font-size: 13px;
      transition: border-color var(--tr)
    }

    .eitem:hover {
      border-color: var(--lines)
    }

    .ebadge {
      padding: 2px 8px;
      border-radius: 6px;
      font-size: 10.5px;
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: .5px;
      flex-shrink: 0;
      margin-top: 1px
    }

    .b-ok {
      background: rgba(62, 207, 142, .14);
      color: var(--ok);
      border: 1px solid rgba(62, 207, 142, .28)
    }

    .b-err {
      background: rgba(240, 78, 106, .14);
      color: var(--err);
      border: 1px solid rgba(240, 78, 106, .28)
    }

    .b-warn {
      background: rgba(245, 166, 35, .14);
      color: var(--warn);
      border: 1px solid rgba(245, 166, 35, .28)
    }

    .b-sys {
      background: rgba(88, 101, 242, .14);
      color: var(--brand2);
      border: 1px solid rgba(88, 101, 242, .28)
    }

    .b-inf {
      background: rgba(0, 184, 255, .14);
      color: var(--cyan);
      border: 1px solid rgba(0, 184, 255, .28)
    }

    .emsg {
      line-height: 1.5;
      word-break: break-all
    }

    .ets {
      font-size: 11px;
      color: var(--muted);
      margin-left: auto;
      white-space: nowrap
    }

    /* ── Utils ── */
    .empty {
      padding: 40px;
      text-align: center;
      color: var(--muted);
      font-size: 13px;
      opacity: .6
    }

    .hidden {
      display: none !important
    }

    /* ── Responsive ── */
    @media (max-width: 768px) {
      #sidebar {
        transform: translateX(-100%)
      }

      #sidebar.open {
        transform: none
      }

      #main {
        margin-left: 0
      }
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 16px
    }

    .section-title {
      font-size: 14px;
      font-weight: 800;
      margin: 10px 0;
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .metric-card {
      background: rgba(9, 17, 31, .65);
      border: 1px solid var(--line);
      border-radius: var(--rs);
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .metric-val {
      font-size: 24px;
      font-weight: 900;
      color: var(--text);
    }

    .metric-label {
      font-size: 12px;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: .5px;
    }

    .status-badge {
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 10px;
      font-weight: 800;
    }

    .status-online {
      background: rgba(62, 207, 142, .14);
      color: var(--ok);
    }

    .status-offline {
      background: rgba(240, 78, 106, .14);
      color: var(--err);
    }
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
</head>

<body>
  <div id="sidebar">
    <div class="sb-head">
      <div class="sb-icon"><i class="fas fa-robot"></i></div>
      <div>
        <div class="sb-name">LAB-BOT</div>
        <div class="sb-sub">v3.1.2 PRO</div>
      </div>
    </div>
    <div class="sb-online">
      <div class="dot"></div>
      <span id="sb-status-text">Opérationnel</span>
    </div>
    <div class="sb-nav">
      <div class="nav-sec">Principal</div>
      <div class="nav-item active" data-page="overview"><i class="ico fas fa-chart-line"></i> Vue d'ensemble</div>
      <div class="nav-item" data-page="events"><i class="ico fas fa-activity"></i> Événements</div>

      <div class="nav-sec">Configuration</div>
      <div class="nav-item" data-page="settings"><i class="ico fas fa-cogs"></i> Général</div>
      <div class="nav-item" data-page="commands"><i class="ico fas fa-terminal"></i> Commandes</div>
      <div class="nav-item" data-page="roles"><i class="ico fas fa-user-tag"></i> Rôles</div>
      <div class="nav-item" data-page="tickets"><i class="ico fas fa-ticket-alt"></i> Tickets</div>

      <div class="nav-sec">Serveurs</div>
      <div class="nav-item" data-page="servers"><i class="ico fas fa-server"></i> Statistiques</div>
    </div>
    <div class="sb-foot">
      <div class="sf-stat">
        <div class="sf-label">CPU</div>
        <div class="sf-val" id="sf-cpu">0%</div>
      </div>
      <div class="sf-stat">
        <div class="sf-label">MEM</div>
        <div class="sf-val" id="sf-mem">0%</div>
      </div>
      <div class="sf-stat">
        <div class="sf-label">PING</div>
        <div class="sf-val" id="sf-ping">--</div>
      </div>
    </div>
  </div>

  <div id="main">
    <div id="topbar">
      <div style="display: flex; align-items: center; gap: 20px;">
        <div class="tb-title" id="pageTitle">Vue d'ensemble</div>

        <div class="global-context" style="display: flex; gap: 10px; align-items: center;">
          <select id="guildServers" onchange="loadCommands()" style="width: 200px; padding: 6px 10px; font-size: 12px;">
            <option value="">Chargement des serveurs...</option>
          </select>
        </div>
      </div>

      <div class="tb-pills">
        <div class="pill"><span class="pill-lbl">UPTIME:</span> <span id="uptime">0h 0m</span></div>
        <div class="pill"><span class="pill-lbl">SUM:</span> <span id="totalInteraction">0</span></div>
      </div>
    </div>

    <!-- Page: Overview -->
    <div class="page active" id="pg-overview">
      <div class="ph">
        <h1>Système & Performance</h1>
        <p>Surveillance en temps réel des ressources du bot.</p>
      </div>

      <div style="display:grid;grid-template-columns: 280px 1fr; gap:18px; align-items:start">
        <div class="card" style="padding:22px">
          <div class="card-title"><span class="ct-dot"></span>Utilisation</div>
          <div class="gauges">
            <div class="gauge-wrap">
              <svg class="ring ring-cpu" width="100" height="100">
                <circle class="ring-bg" cx="50" cy="50" r="42"></circle>
                <circle class="ring-fg" id="cpuRing" cx="50" cy="50" r="42" stroke-dasharray="264"
                  stroke-dashoffset="264"></circle>
              </svg>
              <div class="gauge-val" id="cpuLabel">0%</div>
              <div class="gauge-lbl">CPU Load</div>
            </div>
            <div class="gauge-wrap">
              <svg class="ring ring-heap" width="100" height="100">
                <circle class="ring-bg" cx="50" cy="50" r="42"></circle>
                <circle class="ring-fg" id="heapRing" cx="50" cy="50" r="42" stroke-dasharray="264"
                  stroke-dashoffset="264"></circle>
              </svg>
              <div class="gauge-val" id="heapLabel">0%</div>
              <div class="gauge-lbl">Heap</div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-title"><span class="ct-dot"
              style="background:var(--teal);box-shadow:0 0 8px var(--teal)"></span>Activité</div>
          <div class="spark-wrap">
            <div class="spark-label">
              <span>Opérations / min (Live)</span>
              <span id="ipmLabel">0.00 ipm</span>
            </div>
            <canvas id="sparkline"></canvas>
          </div>
        </div>
      </div>

      <div class="mtiles">
        <div class="mtile">
          <div class="mt-label">Mémoire RSS</div>
          <div class="mt-val" id="stat-rss">0.0 MB</div>
        </div>
        <div class="mtile">
          <div class="mt-label">Mémoire Libre</div>
          <div class="mt-val" id="stat-free">0.0 GB</div>
        </div>
        <div class="mtile">
          <div class="mt-label">Uptime</div>
          <div class="mt-val accent" id="stat-uptime">0h 0m</div>
        </div>
        <div class="mtile">
          <div class="mt-label">Total Interactions</div>
          <div class="mt-val accent" id="stat-total">0</div>
        </div>
      </div>


      <h3 class="section-title"><i class="fas fa-server"></i> Top Serveurs</h3>
      <div class="ilist" id="topGuilds" style="gap:6px">
        <div class="empty">Aucune interaction enregistrée.</div>
      </div>
    </div>

    <!-- Page: Settings -->
    <div class="page" id="pg-settings">
      <div class="ph">
        <h1>Paramètres Généraux</h1>
        <p>Configurez les salons de base pour votre serveur.</p>
      </div>

      <div class="card">
        <div style="display:grid;grid-template-columns: 1fr 1fr; gap:14px">
          <div class="field">
            <label>Salon de Bienvenue</label>
            <select id="welcomeChannel">
              <option value="">Aucun</option>
            </select>
          </div>
          <div class="field">
            <label>Salon de Départ</label>
            <select id="byeChannel">
              <option value="">Aucun</option>
            </select>
          </div>
          <div class="field">
            <label>Salon des Levels</label>
            <select id="levelChannel">
              <option value="">Aucun</option>
            </select>
          </div>
          <div class="field">
            <label>Salon des Logs</label>
            <select id="logChannel">
              <option value="">Aucun</option>
            </select>
          </div>
        </div>
        <div style="display:grid;grid-template-columns: 1fr 1fr; gap:14px; margin-top:20px">
          <div class="field">
            <label>Message de Bienvenue</label>
            <textarea id="welcomeMessage" placeholder="Bienvenue {user} sur {guild} !"
              style="height: 80px; min-height: 80px; border-radius: var(--rs); padding: 12px; font-family: inherit; font-size: 14px; background: rgba(0,0,0,0.2); border: 1px solid var(--line); color: #fff; resize: vertical;"></textarea>
            <p style="font-size:10px; color:var(--muted); margin-top:4px">Variables: {user} (mention), {guild} (nom du
              serveur)</p>
          </div>
          <div class="field">
            <label>Message d'Au revoir</label>
            <textarea id="byeMessage" placeholder="Au revoir {user} !"
              style="height: 80px; min-height: 80px; border-radius: var(--rs); padding: 12px; font-family: inherit; font-size: 14px; background: rgba(0,0,0,0.2); border: 1px solid var(--line); color: #fff; resize: vertical;"></textarea>
            <p style="font-size:10px; color:var(--muted); margin-top:4px">Variables: {user} (nom), {guild} (nom du
              serveur)</p>
          </div>
        </div>
        <div class="btn-row" style="margin-top:20px">
          <button class="btn-primary" id="btn-save-guild" onclick="saveGuildConfig()"><i class="fas fa-save"></i>
            Enregistrer la configuration</button>
        </div>
      </div>

      <h3 class="section-title"><i class="fas fa-bullhorn"></i> Annonces Rapides</h3>
      <div class="card">
        <div style="display:grid;grid-template-columns: 1fr 2fr; gap:14px">
          <div class="field">
            <label>Salon de destination</label>
            <select id="announceChannel">
              <option value="">Sélectionner un salon...</option>
            </select>
          </div>
          <div class="field">
            <label>Contenu de l'annonce (Supporte le markdown)</label>
            <textarea id="announceText" placeholder="Écrivez votre message ici..."
              style="height: 48px; min-height: 48px; border-radius: var(--rs); padding: 12px; font-family: inherit; font-size: 14px; background: rgba(0,0,0,0.2); border: 1px solid var(--line); color: #fff; resize: vertical;"></textarea>
          </div>
        </div>
        <div class="btn-row" style="margin-top:20px">
          <button class="btn-primary" id="btn-announce" onclick="sendAnnounce()"><i class="fas fa-paper-plane"></i>
            Envoyer l'annonce</button>
        </div>
      </div>
    </div>

    <!-- Page: Commands -->
    <div class="page" id="pg-commands">
      <div class="ph">
        <h1>Slash Commandes</h1>
        <p>Activez ou désactivez les fonctionnalités du bot.</p>
      </div>

      <div class="card">
        <div class="btn-row">
          <button class="btn-primary" onclick="loadCommands()"><i class="fas fa-sync"></i> Actualiser</button>
          <button class="btn-ghost" id="btn-save-cmds" onclick="saveCommands()"><i class="fas fa-save"></i>
            Sauvegarder</button>
          <button class="btn-ghost" onclick="toggleAll(true)">Tout activer</button>
          <button class="btn-ghost" onclick="toggleAll(false)">Tout désactiver</button>
        </div>
        <div class="sbar" id="cmd-status"></div>
      </div>

      <div class="card">
        <div class="cmd-search">
          <input type="text" id="cmdFilter" placeholder="Rechercher une commande..." oninput="filterCmds()" />
        </div>
        <div class="cmd-grid" id="cmdGrid">
          <div class="empty">Sélectionnez un serveur en haut pour voir les commandes.</div>
        </div>
      </div>
    </div>

    <!-- Page: Roles -->
    <div class="page" id="pg-roles">
      <div class="ph">
        <h1>Gestion des Rôles</h1>
        <p>Autoroles, rôles d'activité et auto-attributions.</p>
      </div>

      <h3 class="section-title"><i class="fas fa-user-plus"></i> Autorole</h3>
      <div class="card">
        <div style="display:grid;grid-template-columns: 1fr 1fr; gap:14px">
          <div class="field">
            <label>Rôle automatique (Nouveaux membres)</label>
            <select id="autoRole">
              <option value="">Aucun</option>
            </select>
          </div>
          <div class="field">
            <label>Statut</label>
            <div class="toggle-wrap" style="margin-top: 8px">
              <div class="tlbl" id="autoRoleStatus">Désactivé</div>
              <label class="toggle">
                <input type="checkbox" id="autoRoleToggle" onchange="updateAutoRoleTlbl(this)">
                <span class="track"></span>
              </label>
            </div>
          </div>
        </div>
        <div class="btn-row" style="margin-top:20px">
          <button class="btn-primary" id="btn-save-autorole" onclick="saveAutoRoleConfig()"><i class="fas fa-save"></i>
            Appliquer</button>
        </div>
      </div>

      <h3 class="section-title"><i class="fas fa-user-clock"></i> Rôles d'Activité</h3>
      <div class="card">
        <div style="display:grid;grid-template-columns: 1fr 1fr; gap:14px">
          <div class="field">
            <label>Rôle "Actif"</label>
            <select id="activeRole">
              <option value="">Aucun</option>
            </select>
          </div>
          <div class="field">
            <label>Rôle "Inactif"</label>
            <select id="inactiveRole">
              <option value="">Aucun</option>
            </select>
          </div>
          <div class="field" style="grid-column: span 2">
            <label>Seuil d'inactivité (jours)</label>
            <input type="number" id="inactivityDays" min="1" max="90" value="7" />
          </div>
        </div>
        <div class="btn-row" style="margin-top:20px">
          <button class="btn-primary" id="btn-save-activity" onclick="saveActivityConfig()"><i class="fas fa-save"></i>
            Enregistrer</button>
        </div>
      </div>

      <h3 class="section-title"><i class="fas fa-tags"></i> Rôles en Libre-Service</h3>
      <div class="card">
        <div class="field">
          <label>Rôles disponibles (Maintenez Ctrl pour en choisir plusieurs)</label>
          <select id="selfRoles" multiple style="height: 120px">
            <option value="">Chargement...</option>
          </select>
          <div class="btn-row" style="margin-top:16px">
            <button class="btn-primary" id="btn-save-selfroles" onclick="saveSelfRolesConfig()"><i
                class="fas fa-save"></i> Enregistrer les
              rôles</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Page: Tickets -->
    <div class="page" id="pg-tickets">
      <div class="ph">
        <h1>Système de Tickets</h1>
        <p>Configuration du support et de l'assistance.</p>
      </div>

      <div class="card">
        <div style="display:grid;grid-template-columns: 1fr 1fr; gap:14px">
          <div class="field">
            <label>Catégorie des Tickets</label>
            <select id="ticketCategory">
              <option value="">Sélectionner une catégorie</option>
            </select>
          </div>
          <div class="field">
            <label>Rôle Support</label>
            <select id="ticketSupportRole">
              <option value="">Aucun</option>
            </select>
          </div>
          <div class="field" style="grid-column: span 2">
            <label>Salon des Transcripts</label>
            <select id="ticketTranscriptChannel">
              <option value="">Aucun</option>
            </select>
          </div>
        </div>
        <div class="btn-row" style="margin-top:20px">
          <button class="btn-primary" id="btn-save-tickets" onclick="saveTicketConfig()"><i class="fas fa-save"></i>
            Enregistrer la
            config</button>
        </div>
      </div>
    </div>

    <!-- Page: Events -->
    <div class="page" id="pg-events">
      <div class="ph">
        <h1>Journal d'Événements</h1>
        <p>Historique des dernières interactions et logs système.</p>
      </div>
      <div class="card">
        <div class="efeed" id="eventFeed">
          <div class="empty">Aucun événement à afficher.</div>
        </div>
      </div>
    </div>

    <!-- Page: Servers -->
    <div class="page" id="pg-servers">
      <div class="ph">
        <h1>Statistiques du Serveur</h1>
        <p>Analyses détaillées des membres et des rôles.</p>
      </div>

      <div style="display:grid;grid-template-columns: 1fr 340px; gap:18px; align-items:start">
        <div class="card" id="guildInfoCard">
          <div class="empty">Sélectionnez un serveur en haut dans la barre de navigation.</div>
        </div>

        <div class="card" id="guildRolesCard" style="display:none">
          <div class="card-title"><span class="ct-dot"
              style="background:var(--warn);box-shadow:0 0 8px var(--warn)"></span>Top Rôles</div>
          <div class="ilist" id="roleList"></div>
        </div>
      </div>
    </div>

    <!-- SVG Gradients -->
    <svg width="0" height="0" style="position:absolute">
      <defs>
        <linearGradient id="gCpu" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" stop-color="var(--brand)" />
          <stop offset="100%" stop-color="var(--cyan)" />
        </linearGradient>
        <linearGradient id="gHeap" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" stop-color="var(--teal)" />
          <stop offset="100%" stop-color="var(--cyan)" />
        </linearGradient>
      </defs>
    </svg>

    <script>
      const $ = id => document.getElementById(id);
      // Toasts
      function toast(msg, type = "info") {
        const wrap = $("toast-wrap");
        const t = document.createElement("div");
        t.className = `toast toast-${type}`;

        const icon = type === "ok" ? "fa-check-circle" : (type === "err" ? "fa-exclamation-circle" : "fa-info-circle");
        t.innerHTML = `<i class="fas ${icon}"></i> <span>${msg}</span>`;

        wrap.appendChild(t);
        setTimeout(() => t.remove(), 3200);
      }

      function setLoading(id, isLoading) {
        const btn = $(id);
        if (!btn) return;
        if (isLoading) {
          btn.classList.add("btn-loading");
          const icon = btn.querySelector("i");
          if (icon) icon.style.display = "none";
          const s = document.createElement("span");
          s.className = "spinner";
          btn.prepend(s);
        } else {
          btn.classList.remove("btn-loading");
          const s = btn.querySelector(".spinner");
          if (s) s.remove();
          const icon = btn.querySelector("i");
          if (icon) icon.style.display = "inline-block";
        }
      }
      ;

      // Routing
      document.querySelectorAll(".nav-item").forEach(el => {
        el.addEventListener("click", () => {
          document.querySelectorAll(".nav-item").forEach(x => x.classList.remove("active"));
          el.classList.add("active");
          document.querySelectorAll(".page").forEach(x => x.classList.remove("active"));
          const pid = "pg-" + el.dataset.page;
          if ($(pid)) $(pid).classList.add("active");
          $("pageTitle").textContent = el.textContent.trim();
          if (window.innerWidth <= 768) $("sidebar").classList.remove("open");
        });
      });

      // API Wrapper
      async function api(path, method = "GET", body = null) {
        const opts = {
          method,
          headers: { "content-type": "application/json" }
        };
        if (body) opts.body = JSON.stringify(body);
        const r = await fetch(path, opts);
        if (!r.ok) throw new Error(r.status);
        return r.json();
      }

      // Sparkline Logic
      let sparkData = Array(30).fill(0);
      function drawSpark() {
        const c = $("sparkline");
        const ctx = c.getContext("2d");
        const w = c.clientWidth;
        const h = c.clientHeight;
        c.width = w; c.height = h;

        ctx.clearRect(0, 0, w, h);
        const max = Math.max(...sparkData, 1) * 1.2;
        const step = w / (sparkData.length - 1);

        const grad = ctx.createLinearGradient(0, 0, 0, h);
        grad.addColorStop(0, "rgba(54, 209, 196, 0.4)");
        grad.addColorStop(1, "rgba(54, 209, 196, 0)");

        ctx.beginPath();
        ctx.moveTo(0, h);
        for (let i = 0; i < sparkData.length; i++) {
          const x = i * step;
          const y = h - (sparkData[i] / max) * h;
          ctx.lineTo(x, y);
        }
        ctx.lineTo(w, h);
        ctx.fillStyle = grad;
        ctx.fill();

        ctx.beginPath();
        ctx.moveTo(0, h - (sparkData[0] / max) * h);
        for (let i = 1; i < sparkData.length; i++) {
          ctx.lineTo(i * step, h - (sparkData[i] / max) * h);
        }
        ctx.strokeStyle = "var(--teal)";
        ctx.lineWidth = 2;
        ctx.stroke();
      }

      // Commands Logic
      async function loadGuilds() {
        const { guilds } = await api("/api/guilds");
        const sel = $("guildServers");
        const prev = sel.value;
        sel.innerHTML = guilds.map(g => `<option value="${g.id}">${g.name} (${g.memberCount})</option>`).join("");
        if (prev && guilds.find(g => g.id === prev)) sel.value = prev;
        return guilds;
      }

      async function loadCommands() {
        const gid = $("guildServers").value;
        if (!gid) return;
        async function loadChannels(guildId) {
          try {
            const { channels } = await api(`/api/guild-channels/${guildId}`);
            const selectors = ["welcomeChannel", "byeChannel", "levelChannel", "logChannel", "ticketTranscriptChannel", "announceChannel"];
            selectors.forEach(sid => {
              const s = $(sid);
              if (!s) return;
              const current = s.value;
              s.innerHTML = `<option value="">Aucun</option>` +
                channels.map(c => `<option value="${c.id}">#${c.name}</option>`).join("");
              s.value = current;
            });
          } catch (e) {
            console.error("loadChannels err", e);
          }
        }

        async function sendAnnounce() {
          const guildId = $("guildServers").value;
          const channelId = $("announceChannel").value;
          const message = $("announceText").value;

          if (!guildId) return toast("Sélectionnez un serveur.", "err");
          if (!channelId) return toast("Sélectionnez un salon.", "err");
          if (!message.trim()) return toast("Écrivez un message.", "err");

          setLoading("btn-announce", true);
          try {
            await api("/api/announce", "POST", { guildId, channelId, message });
            toast("Annonce envoyée !", "ok");
            $("announceText").value = "";
          } catch (e) {
            toast("Erreur d'envoi.", "err");
          } finally {
            setLoading("btn-announce", false);
          }
        }
        try {
          const { commands } = await api("/api/command-config/" + gid);
          renderCommands(commands);

          await loadChannels(gid);

          const { roles } = await api("/api/guild-roles/" + gid);
          const roleOps = '<option value="">Aucun</option>' + roles.map(r => `<option value="${r.id}">${r.name}</option>`).join("");
          $("activeRole").innerHTML = roleOps;
          $("inactiveRole").innerHTML = roleOps;
          $("ticketSupportRole").innerHTML = roleOps;

          const { categories } = await api("/api/guild-categories/" + gid);
          const catOps = '<option value="">Sélectionner une catégorie</option>' + categories.map(c => `<option value="${c.id}">${c.name}</option>`).join("");
          $("ticketCategory").innerHTML = catOps;

          $("selfRoles").innerHTML = roleOps.replace('Aucun', 'Sélectionner les rôles');

          $("autoRole").innerHTML = roleOps;

          const { config } = await api("/api/guild-config/" + gid);
          $("welcomeChannel").value = config.welcomeChannel || "";
          $("byeChannel").value = config.byeChannel || "";
          $("levelChannel").value = config.levelChannel || "";
          $("logChannel").value = config.logChannelId || "";
          $("activeRole").value = config.activeRoleId || "";
          $("inactiveRole").value = config.inactiveRoleId || "";
          $("inactivityDays").value = config.inactivityDays || 7;
          $("ticketCategory").value = config.ticketCategoryId || "";
          $("ticketSupportRole").value = config.ticketSupportRoleId || "";
          $("ticketTranscriptChannel").value = config.ticketTranscriptChannelId || "";
          $("autoRole").value = config.autoRoleId || "";
          $("autoRoleToggle").checked = config.autoRoleEnabled || false;
          $("autoRoleStatus").textContent = config.autoRoleEnabled ? "Activé" : "Désactivé";
          $("announceChannel").value = config.announceChannelId || "";
          $("welcomeMessage").value = config.welcomeMessage || "";
          $("byeMessage").value = config.byeMessage || "";


          // Populate multi-select for selfRoles
          const selfRolesVal = config.selfRoles || [];
          [...$("selfRoles").options].forEach(opt => {
            opt.selected = selfRolesVal.includes(opt.value);
          });
          toast("Configuration chargée.", "ok");
        } catch (e) {
          toast("Erreur d'accès API.", "err");
        }
      }

      function renderCommands(commands) {
        const grid = $("cmdGrid");
        grid.innerHTML = "";
        if (!commands.length) {
          grid.innerHTML = `<div class="empty">Aucune commande trouvée.</div>`;
          return;
        }

        // Group by category
        const groups = {};
        commands.forEach(c => {
          const cat = c.category || "Autres";
          if (!groups[cat]) groups[cat] = [];
          groups[cat].push(c);
        });

        Object.keys(groups).sort().forEach(cat => {
          const catTitle = document.createElement("div");
          catTitle.className = "cmd-cat-title";
          catTitle.innerHTML = `<i class="fas fa-folder-open"></i> ${cat}`;
          grid.appendChild(catTitle);

          groups[cat].forEach(cmd => {
            const div = document.createElement("div");
            div.className = "cmd-card";
            div.innerHTML = `
              <div class="cmd-info">
                <div class="cmd-name">/${cmd.name}</div>
              </div>
              <label class="toggle">
                <input type="checkbox" ${cmd.enabled ? "checked" : ""} data-name="${cmd.name}">
                <span class="track"></span>
              </label>
            `;
            grid.appendChild(div);
          });
        });
      }
      function updateTlbl(cb) {
        cb.parentElement.previousElementSibling.textContent = cb.checked ? "Activée" : "Désactivée";
      }

      async function saveCommands() {
        const gid = $("guildServers").value;
        if (!gid) return;
        setLoading("btn-save-cmds", true);
        const cmds = [...document.querySelectorAll(".cmd-card input[type='checkbox']")].map(input => ({
          name: input.dataset.name,
          enabled: input.checked
        }));
        try {
          await api("/api/command-config/" + gid, "POST", { commands: cmds });
          toast("Slash commandes mises à jour.", "ok");
        } catch (e) {
          toast("Erreur de sauvegarde.", "err");
        } finally {
          setLoading("btn-save-cmds", false);
        }
      }

      async function saveGuildConfig() {
        const guildId = $("guildServers").value;
        if (!guildId) return;
        setLoading("btn-save-guild", true);
        try {
          const config = {
            welcomeChannel: $("welcomeChannel").value,
            byeChannel: $("byeChannel").value,
            levelChannel: $("levelChannel").value,
            logChannel: $("logChannel").value,
            welcomeMessage: $("welcomeMessage").value,
            byeMessage: $("byeMessage").value,
          };
          await api(`/api/guild-config/${guildId}`, "POST", { config });
          toast("Paramètres généraux enregistrés.", "ok");
        } catch (e) {
          toast("Erreur de sauvegarde.", "err");
        } finally {
          setLoading("btn-save-guild", false);
        }
      }
      async function saveActivityConfig() {
        const gid = $("guildServers").value;
        if (!gid) return;
        setLoading("btn-save-activity", true);
        try {
          const config = {
            activeRoleId: $("activeRole").value,
            inactiveRoleId: $("inactiveRole").value,
            inactivityDays: parseInt($("inactivityDays").value) || 7,
          };
          await api("/api/guild-config/" + gid, "POST", { config });
          toast("Configuration des rôles enregistrée !", "ok");
        } catch (e) {
          toast("Erreur lors de la sauvegarde.", "err");
        } finally {
          setLoading("btn-save-activity", false);
        }
      }

      async function saveTicketConfig() {
        const gid = $("guildServers").value;
        if (!gid) return;
        setLoading("btn-save-tickets", true);
        try {
          const config = {
            ticketCategoryId: $("ticketCategory").value,
            ticketSupportRoleId: $("ticketSupportRole").value,
            ticketTranscriptChannelId: $("ticketTranscriptChannel").value,
          };
          await api("/api/guild-config/" + gid, "POST", { config });
          toast("Configuration tickets enregistrée.", "ok");
        } catch (e) {
          toast("Erreur de sauvegarde.", "err");
        } finally {
          setLoading("btn-save-tickets", false);
        }
      }

      async function saveSelfRolesConfig() {
        const gid = $("guildServers").value;
        if (!gid) return;
        const config = {
          selfRoles: selectedRoles
        };
        toast("Sauvegarde des rôles...", "ok");
        try {
          await api("/api/guild-config/" + gid, "POST", { config });
          toast("Rôles en libre-service enregistrés !", "ok");
        } catch (e) { toast("Erreur lors de la sauvegarde.", "err"); }
      }

      function updateAutoRoleTlbl(cb) {
        $("autoRoleStatus").textContent = cb.checked ? "Activé" : "Désactivé";
      }

      async function saveAutoRoleConfig() {
        const gid = $("guildServers").value;
        if (!gid) return;
        const config = {
          autoRoleId: $("autoRole").value,
          autoRoleEnabled: $("autoRoleToggle").checked
        };
        toast("Sauvegarde de l'Autorole...", "ok");
        try {
          await api("/api/guild-config/" + gid, "POST", { config });
          toast("Configuration Autorole enregistrée !", "ok");
        } catch (e) { toast("Erreur lors de la sauvegarde.", "err"); }
      }

      function toggleAll(val) {
        document.querySelectorAll(".cmd-row input").forEach(i => { i.checked = val; updateTlbl(i); });
      }

      function filterCmds() {
        const q = $("cmdFilter").value.toLowerCase();
        document.querySelectorAll(".cmd-row").forEach(r => {
          r.style.display = r.dataset.name.includes(q) ? "flex" : "none";
        });
      }

      // Server Stats Logic
      async function refreshGuildStats(gid) {
        if (!gid) return;
        try {
          const { stats } = await api("/api/guild-stats/" + gid);
          $("guildRolesCard").style.display = "block";
          $("guildInfoCard").innerHTML = `
          <div class="card-title"><span class="ct-dot" style="background:var(--cyan);box-shadow:0 0 8px var(--cyan)"></span>${stats.guildName}</div>
          <div class="mtiles" style="grid-template-columns: repeat(auto-fill, minmax(130px, 1fr))">
            <div class="mtile"><div class="mt-label">Membres</div><div class="mt-val">${stats.memberCount}</div></div>
            <div class="mtile"><div class="mt-label">Humains</div><div class="mt-val">${stats.humans}</div></div>
            <div class="mtile"><div class="mt-label">Bots</div><div class="mt-val">${stats.bots}</div></div>
            <div class="mtile"><div class="mt-label">Rôles</div><div class="mt-val">${stats.roleCount}</div></div>
          </div>
          <div style="margin-top:15px; font-size:12px; color:var(--muted)">
            Propriétaire ID: <code>${stats.ownerId}</code><br>
            Créé le: ${new Date(stats.createdAt).toLocaleDateString()}
          </div>
        `;
          $("roleList").innerHTML = stats.topRoles.map(r => `
          <div style="display:flex; justify-content:space-between; align-items:center; background:rgba(255,255,255,0.03); padding:8px 12px; border-radius:8px">
            <span style="font-size:13px; font-weight:600">${r.roleName}</span>
            <span style="font-size:12px; font-weight:800; color:var(--brand2)">${r.count}</span>
          </div>
        `).join("");
        } catch (e) { }
      }

      // Live Metrics Refresh
      async function refreshStats() {
        const { summary } = await api("/api/bot/summary");

        // Top bar & metrics
        $("uptime").textContent = summary.uptimeSec ? formatSec(summary.uptimeSec) : "--";
        $("stat-uptime").textContent = summary.uptimeSec ? formatSec(summary.uptimeSec) : "--";
        $("ipmLabel").textContent = (summary.interactionsPerMin || 0).toFixed(2) + " ipm";
        $("stat-total").textContent = summary.totalInteractions;
        $("totalInteraction").textContent = summary.totalInteractions;
        $("sf-ping").textContent = summary.pingMs + "ms";
        $("sf-cpu").textContent = summary.runtime.cpuProcessPercent + "%";
        $("sf-mem").textContent = Math.round((summary.runtime.heapUsedMb / summary.runtime.heapTotalMb) * 100) + "%";

        // Sparkline
        sparkData.push(summary.interactionsPerMin);
        if (sparkData.length > 30) sparkData.shift();
        drawSpark();

        // Memory & System
        $("stat-rss").textContent = summary.runtime.rssMb + " MB";
        $("stat-free").textContent = (summary.runtime.systemFreeMemMb / 1024).toFixed(1) + " GB";

        // Gauges
        const cpu = summary.runtime.cpuProcessPercent;
        const heap = Math.round((summary.runtime.heapUsedMb / summary.runtime.heapTotalMb) * 100);

        $("cpuRing").style.strokeDashoffset = 264 - (264 * cpu) / 100;
        $("cpuLabel").textContent = cpu + "%";
        $("heapRing").style.strokeDashoffset = 264 - (264 * heap) / 100;
        $("heapLabel").textContent = heap + "%";

        // Top Guilds
        const guilds = $("topGuilds");
        if (summary.topGuilds && summary.topGuilds.length) {
          guilds.innerHTML = summary.topGuilds.map(g => `
          <div style="display:flex; justify-content:space-between; align-items:center; background:rgba(255,255,255,0.03); padding:8px 12px; border-radius:8px">
            <span style="font-size:13px; font-weight:600">${g.guildName}</span>
            <span style="font-size:12px; font-weight:800; color:var(--brand2)">${g.interactions} op</span>
          </div>
        `).join("");
        }
      }

      function formatSec(sec) {
        if (sec < 60) return sec + "s";
        if (sec < 3600) return Math.floor(sec / 60) + "m " + (sec % 60) + "s";
        return Math.floor(sec / 3600) + "h " + Math.floor((sec % 3600) / 60) + "m";
      }

      async function refreshEvents() {
        const { events } = await api("/api/bot/events");
        const feed = $("eventFeed");
        if (!events.length) return;
        feed.innerHTML = events.map(e => {
          let typeCls = "b-ok";
          if (e.type === "error") typeCls = "b-err";
          if (e.type === "blocked") typeCls = "b-warn";
          if (e.type === "system") typeCls = "b-sys";

          const time = e.at ? e.at.split("T")[1].split(".")[0] : "--:--:--";
          const label = e.type === "command" ? `/${e.commandName}` : e.status;
          const msg = e.detail || "";

          return `
          <div class="eitem">
            <span class="ebadge ${typeCls}">${e.type}</span>
            <div class="emsg"><b>${label}</b> ${msg}</div>
            <div class="ets">${time}</div>
          </div>
        `;
        }).join("");
      }

      async function refreshLive() {
        try {
          await refreshStats();
          await refreshEvents();
          const gid = $("guildServers").value;
          if (gid) await refreshGuildStats(gid);
          $("sb-status-text").textContent = "Opérationnel";
          $("sb-status-text").parentElement.style.color = "var(--ok)";
        } catch (e) {
          $("sb-status-text").textContent = "Hors ligne";
          $("sb-status-text").parentElement.style.color = "var(--err)";
        }
      }


      (async () => {
        try {
          const guilds = await loadGuilds();
          if (guilds.length) await refreshGuildStats(guilds[0].id);
          await refreshLive();
        } catch (e) {
          toast("Impossible de joindre l'API.", "err");
        }
        setInterval(refreshLive, 5000);
      })();
    </script>
</body>

</html>